import pandas as pd
import numpy as np

def generate_full_database():
    print("üöÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¶–∏—Ñ—Ä–æ–≤–æ–≥–æ –î–≤–æ–π–Ω–∏–∫–∞ (Scientific_Data_Extended.csv)...")
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏: 50 —Ç–æ—á–µ–∫ –æ—Ç 0 –¥–æ 10 —á–∞—Å–æ–≤
    n_points = 50
    time = np.linspace(0, 10, n_points) 

    # ==========================================
    # 1. –ú–û–î–ï–õ–¨ –ê–ô–†–ê–ù–ê (–§–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è)
    # ==========================================
    # –°—Ç–∞—Ä—Ç pH: 5.98 (–ø–æ –≤–∞—à–µ–º—É –ø—Ä–æ—Ç–æ–∫–æ–ª—É)
    # –§–∏–Ω–∏—à (10—á): ~4.33 (–ö–æ–Ω—Ç—Ä–æ–ª—å), ~4.21 (–û–ø—ã—Ç 2)
    
    ayran_data = []
    
    # –°—Ü–µ–Ω–∞—Ä–∏–∏
    scenarios_ayran = [
        # –ù–∞–∑–≤–∞–Ω–∏–µ              –¢–∏–ø      –î–æ–∑–∞%   –¶–µ–ª—å pH(10—á)  k (–°–∫–æ—Ä–æ—Å—Ç—å)
        ('–ö–æ–Ω—Ç—Ä–æ–ª—å',           'dry',   0.0,    4.33,         0.688), 
        ('–û–ø—ã—Ç 1 (–°—É—Ö–∞—è 1%)',  'dry',   1.0,    4.35,         0.680),
        ('–û–ø—ã—Ç 1 (–°—É—Ö–∞—è 2%)',  'dry',   2.0,    4.37,         0.671),
        ('–û–ø—ã—Ç 1 (–°—É—Ö–∞—è 3%)',  'dry',   3.0,    4.40,         0.659), # –ë—É—Ñ–µ—Ä (–º–µ–¥–ª–µ–Ω–Ω–µ–µ)
        ('–û–ø—ã—Ç 2 (–°–∏—Ä–æ–ø 1%)',  'wet',   1.0,    4.30,         0.700),
        ('–û–ø—ã—Ç 2 (–°–∏—Ä–æ–ø 2%)',  'wet',   2.0,    4.27,         0.713),
        ('–û–ø—ã—Ç 2 (–°–∏—Ä–æ–ø 3%)',  'wet',   3.0,    4.24,         0.725),
        ('–û–ø—ã—Ç 2 (–°–∏—Ä–æ–ø 4%)',  'wet',   4.0,    4.21,         0.738)  # –°–∞—Ö–∞—Ä (–±—ã—Å—Ç—Ä–µ–µ)
    ]

    for name, type_, dose, target_ph, k in scenarios_ayran:
        # –§–æ—Ä–º—É–ª–∞: pH = 5.98 - k * ln(t + 1)
        ph_curve = 5.98 - k * np.log(time + 1)
        
        for t, p in zip(time, ph_curve):
            # –†–∞—Å—á–µ—Ç —Å—É—Ö–∏—Ö –≤–µ—â–µ—Å—Ç–≤ —Å —É—á–µ—Ç–æ–º –¥–æ–±–∞–≤–∫–∏
            # –ú–æ–ª–æ–∫–æ ~12% —Å.–≤. –î–æ–±–∞–≤–∫–∞ —Å—É—Ö–∞—è (92% —Å.–≤.), –°–∏—Ä–æ–ø (60% —Å.–≤.)
            base_dm = 12.0
            added_dm = (dose * 0.92) if type_ == 'dry' else (dose * 0.60)
            
            ayran_data.append({
                'productname': '–ê–π—Ä–∞–Ω',
                'process_stage': '–§–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è',
                'duration_hours': t,
                'ph': p,
                'temperature_c': 42.0, # –¢–µ—Ä–º–æ—Å—Ç–∞—Ç
                'experiment_type': name,
                'additive_dose_pct': dose,
                '–≤–ª–∞–≥–∞': 100 - (base_dm + added_dm), 
                '—Å—É—Ö–∏–µ_–≤–µ—â–µ—Å—Ç–≤–∞': base_dm + added_dm
            })

    # ==========================================
    # 2. –ú–û–î–ï–õ–¨ –°–ê–†–´ –Ü–†–Ü–ú–®–Ü–ö (–í–∞—Ä–∫–∞)
    # ==========================================
    # –ü—Ä–æ—Ü–µ—Å—Å: –£–≤–∞—Ä–∏–≤–∞–Ω–∏–µ. –í–ª–∞–≥–∞ –ø–∞–¥–∞–µ—Ç, pH –º–µ–Ω—è–µ—Ç—Å—è —Å–ª–∞–±–æ (–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è).
    
    irimshik_data = []
    scenarios_irim = [
        ('–ö–æ–Ω—Ç—Ä–æ–ª—å', 0.0),
        ('–û–ø—ã—Ç (4%)', 4.0),
        ('–û–ø—ã—Ç (5%)', 5.0)
    ]
    
    for name, dose in scenarios_irim:
        # –í–ª–∞–≥–∞: –ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ç–∞—Ä—Ç 75%, –û–ø—ã—Ç (—Å —Å—É—Ö–æ–π –¥–æ–±–∞–≤–∫–æ–π) - –º–µ–Ω—å—à–µ.
        w_start = 75.0 - (dose * 0.8)
        w_final = 18.0
        # –°–∫–æ—Ä–æ—Å—Ç—å —Å—É—à–∫–∏ (k) —Ä–∞—Å—Ç–µ—Ç —Å –¥–æ–±–∞–≤–∫–æ–π (—Ä—ã—Ö–ª–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
        k_speed = 0.3 + (0.02 * dose) 
        
        # –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å —Å—É—à–∫–∏
        moisture_curve = w_final + (w_start - w_final) * np.exp(-k_speed * time)
        
        # pH: –°—Ç–∞—Ä—Ç 5.98 -> –§–∏–Ω–∏—à ~5.50 (–∏–∑-–∑–∞ —É–≤–∞—Ä–∏–≤–∞–Ω–∏—è –∫–∏—Å–ª–æ—Ç)
        ph_curve = 5.98 - (0.48 * (time / 10.0))
        
        for t, m, p in zip(time, moisture_curve, ph_curve):
            irimshik_data.append({
                'productname': '–°–∞—Ä—ã —ñ—Ä—ñ–º—à—ñ–∫',
                'process_stage': '–í–∞—Ä–∫–∞',
                'duration_hours': t,
                'ph': p,
                'temperature_c': 96.0, # –ö–∏–ø–µ–Ω–∏–µ
                'experiment_type': name,
                'additive_dose_pct': dose,
                '–≤–ª–∞–≥–∞': m,
                '—Å—É—Ö–∏–µ_–≤–µ—â–µ—Å—Ç–≤–∞': 100.0 - m
            })

    # ==========================================
    # 3. –†–ê–°–ß–ï–¢ 14 –ü–ï–†–ï–ú–ï–ù–ù–´–• (–§–ò–ó–ò–ö–ê + –•–ò–ú–ò–Ø)
    # ==========================================
    df = pd.DataFrame(ayran_data + irimshik_data)
    
    # --- 3.1 –•–∏–º–∏—á–µ—Å–∫–∏–π —Å–æ—Å—Ç–∞–≤ (–ë–ñ–£) ---
    # –ë–∞–∑–∞: –ú–æ–ª–æ–∫–æ (–ñ–∏—Ä 3.2, –ë–µ–ª–æ–∫ 3.0, –£–≥–ª–µ–≤ 4.7)
    # –î–æ–±–∞–≤–∫–∞ 1 (–°—É—Ö–∞—è): –ñ–∏—Ä 3.0, –ë–µ–ª–æ–∫ 12.0, –£–≥–ª–µ–≤ 65.0 (–∏–∑ –≤–∞—à–µ–≥–æ —Ñ–æ—Ç–æ)
    
    dose_frac = df['additive_dose_pct'] / 100.0
    
    # –ï—Å–ª–∏ —ç—Ç–æ –ê–π—Ä–∞–Ω —Å —Å—É—Ö–æ–π –¥–æ–±–∞–≤–∫–æ–π (–û–ø—ã—Ç 1)
    is_dry_exp = df['experiment_type'].str.contains('–°—É—Ö–∞—è') | df['experiment_type'].str.contains('–û–ø—ã—Ç \(')
    
    # –ñ–∏—Ä (—Å–º–µ—à–µ–Ω–∏–µ)
    df['fat_pct'] = np.where(is_dry_exp, 
                             3.2 * (1 - dose_frac) + 3.0 * dose_frac, 
                             3.2) # –î–ª—è —Å–∏—Ä–æ–ø–∞ –∂–∏—Ä –ø–æ—á—Ç–∏ 0, –ø—Ä–µ–Ω–µ–±—Ä–µ–≥–∞–µ–º
    
    # –ë–µ–ª–æ–∫ (—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–æ—Å—Ç –æ—Ç –¥–æ–±–∞–≤–∫–∏!)
    df['protein_pct'] = np.where(is_dry_exp, 
                                 3.0 * (1 - dose_frac) + 12.0 * dose_frac, 
                                 3.0)
    
    # –£–≥–ª–µ–≤–æ–¥—ã (—Ä–∞—Å—á–µ—Ç–Ω–æ –¥–ª—è –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏)
    carbs = np.where(is_dry_exp, 
                     4.7 * (1 - dose_frac) + 65.0 * dose_frac, 
                     4.7 + (df['additive_dose_pct'] * 0.6)) # –í —Å–∏—Ä–æ–ø–µ —Å–∞—Ö–∞—Ä–∞
                     
    # --- 3.2 –§–∏–∑–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ ---
    
    # –ü–ª–æ—Ç–Ω–æ—Å—Ç—å (–∫–≥/–º3) = 1000 + (–ñ–∏—Ä*1.2 + –°–û–ú–û*3.8)
    somo = df['protein_pct'] + carbs + 0.7 # –ú–∏–Ω–µ—Ä–∞–ª—ã
    df['density_kg_m3'] = 1000 + (df['fat_pct'] * 1.2 + somo * 3.8)
    
    # –ö–∏—Å–ª–æ—Ç–Ω–æ—Å—Ç—å (¬∞T) - –æ–±—Ä–∞—Ç–Ω–∞ pH
    # –ê–π—Ä–∞–Ω: 5.98 -> 20¬∞T, 4.2 -> 90¬∞T
    df['–∫–∏—Å–ª–æ—Ç–Ω–æ—Å—Ç—å'] = np.where(df['productname']=='–ê–π—Ä–∞–Ω', 
                                 20 + (5.98 - df['ph']) * 40, 
                                 20 + (5.98 - df['ph']) * 10) # –ò—Ä–∏–º—à–∏–∫ –∫–∏—Å–Ω–µ—Ç —Å–ª–∞–±–µ–µ
    
    # OrP (–û–∫–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ-–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª, –º–í)
    # –ó–∞–≤–∏—Å–∏—Ç –æ—Ç pH (–ù–µ—Ä–Ω—Å—Ç) –∏ –∂–∏–∑–Ω–µ–¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –±–∞–∫—Ç–µ—Ä–∏–π
    df['orp_mv'] = 200 - (df['ph'] * 30) + np.random.normal(0, 2, len(df))
    
    # –í—è–∑–∫–æ—Å—Ç—å (mPa*s)
    # –ê–π—Ä–∞–Ω: –†–∞—Å—Ç–µ—Ç —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–∏ pH < 4.6 (—Å–≥—É—Å—Ç–æ–∫) + –≤–∫–ª–∞–¥ –∑–∞–≥—É—Å—Ç–∏—Ç–µ–ª—è (—É–≥–ª–µ–≤–æ–¥—ã)
    visc_base = 1.5 + 500 * np.exp(-1.5 * (df['ph'] - 3.8))
    visc_add = df['additive_dose_pct'] * 50 # –í–ª–∏—è–Ω–∏–µ –∫—Ä–∞—Ö–º–∞–ª–∞/—É–≥–ª–µ–≤–æ–¥–æ–≤ –¥–æ–±–∞–≤–∫–∏
    
    # –ò—Ä–∏–º—à–∏–∫: –†–∞—Å—Ç–µ—Ç –ø—Ä–∏ –≤—ã–∫–∏–ø–∞–Ω–∏–∏ –≤–æ–¥—ã
    visc_irim = 100 * np.exp(0.05 * (100 - df['–≤–ª–∞–≥–∞']))
    
    df['viscosity_mpa_s'] = np.where(df['productname']=='–ê–π—Ä–∞–Ω', 
                                     visc_base + visc_add, 
                                     visc_irim)
    
    # –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤–æ–¥—ã (aw)
    df['water_activity'] = df['–≤–ª–∞–≥–∞'] / 100 * 0.99
    
    # –ú–∏–∫—Ä–æ–±–∏–æ–ª–æ–≥–∏—è (–ö–ú–ê–§–ê–Ω–ú)
    # –ê–π—Ä–∞–Ω: –†–æ—Å—Ç –±–∞–∫—Ç–µ—Ä–∏–π. –ò—Ä–∏–º—à–∏–∫: –ì–∏–±–µ–ª—å –ø—Ä–∏ –≤–∞—Ä–∫–µ.
    df['kmafanm'] = np.where(df['productname']=='–ê–π—Ä–∞–Ω',
                             10000 * np.exp(df['duration_hours']), # –†–æ—Å—Ç
                             10000 * np.exp(-df['duration_hours'])) # –ì–∏–±–µ–ª—å
                             
    df['lactic_bacteria'] = 10**7 # –°—Ç–∞—Ä—Ç–æ–≤–∞—è –∑–∞–∫–≤–∞—Å–∫–∞
    
    # –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    df['pressure_mpa'] = 0.1 # –ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω–æ–µ (–≤ —Ç–∞–Ω–∫–µ)
    df['humidity_pct'] = 80.0

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    filename = "Scientific_Data_Extended.csv"
    df.to_csv(filename, index=False)
    print(f"‚úÖ –ì–æ—Ç–æ–≤–æ! –§–∞–π–ª '{filename}' —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω.")
    print(f"   - –°—Ç—Ä–æ–∫: {len(df)}")
    print(f"   - –ü—Ä–æ–¥—É–∫—Ç—ã: {df['productname'].unique()}")
    print(f"   - –°—Ü–µ–Ω–∞—Ä–∏–∏: {df['experiment_type'].unique()}")

if __name__ == "__main__":
    generate_full_database()